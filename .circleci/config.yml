version: 2
jobs:
  test1:
    docker:
      - image: circleci/golang:1.9
    steps:
      - checkout
      - run: echo "completed test 1, check check"
  test2:
    docker:
      - image: circleci/golang:1.9
    steps:
      - checkout
      - run: echo "completed test 2"
      - run: echo "bla bla"
      # - run: if [ "$FAIL" = "true" ]; then exit 1; fi
  build:
    docker:
      - image: circleci/golang:1.9
      - image: circleci/mongo:4.0.9
    working_directory: /go/src/github.com/soulchips/go-slackbot
    steps:
      
      - checkout
      - run: go get github.com/pilu/fresh
      - run: go get github.com/Krognol/go-wolfram
      - run: go get github.com/christianrondeau/go-wit
      - run: go get github.com/joho/godotenv
      - run: go get github.com/nlopes/slack
      - run: go get go.mongodb.org/mongo-driver/mongo
      - run: go get go.mongodb.org/mongo-driver/mongo/options
      - run: ls
      - run: go test -v ./...
      - run: cd slackbot && go build
      - store_artifacts:
          path: slackbot/slackbot
          destination: builds/slackbot
      - store_artifacts:
          path: slackbot/builds/Dockerfile.slackbot
          destination: builds/Dockerfile.slackbot
workflows:
  version: 2
  build_and_test:
    jobs:
      - build
      - test1
          # type: approval
          # requires:
          #   - build
      - test2:
          requires:
            - test1